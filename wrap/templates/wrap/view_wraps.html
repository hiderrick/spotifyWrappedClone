{% load static %}
{% csrf_token %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Your Spotify Wraps</title>
    <link rel="stylesheet" href="{% static 'css/styles.css' %}">
    <script src="{% static 'js/translation.js' %}"></script>
    <style>
        /* CSS to position the share buttons in the top-right corner */
        .share-buttons {
            position: fixed;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            z-index: 1000;
        }

        .top-left, .top-left-below {
            position: fixed;
            left: 20px;
            z-index: 1000;
        }

        .top-left {
            top: 20px;
        }

        .top-left-below {
            top: 70px; /* Positioned below the "Back to Home" button */
        }
    </style>
</head>
<body>

    <script>

        // Slideshow functionality
        setInterval(() => plusDivs(1), 5000);

        let slideIndex = 1;
        showDivs(slideIndex);

        function plusDivs(n) {
            showDivs(slideIndex += n);
        }

        function showDivs(n) {
            let i;
            const x = document.getElementsByClassName("mySlides");
            if (n <= x.length) {
                for (i = 0; i < x.length; i++) {
                    x[i].style.display = "none";
                }
                x[slideIndex - 1].style.display = "block";
            }
        }
    </script>

    <!-- Left-side Navigation Buttons -->
    <div class="top-left">
        <a href="{% url 'home' %}" class="btn btn-primary">Back to Home</a>
        <a href="{% url 'profile' %}" class="btn btn-primary">Go to Profile</a>
    </div>

    <div class="container" id="content">
        <h1>Your Spotify Wraps</h1>
        {% if no_wraps %}
            <p>No Wrap data available. Please listen to some music to generate your Spotify Wrap!</p>
        {% else %}
            <ul>
                {% for wrap in wraps %}
                    <li>
                        <a href="{% url 'your_wrap' wrap.wrap_id %}">{{ wrap.name }}</a> :
                        <a href="{% url 'wrap_detail' wrap.wrap_id %}">Details</a>
                        | <a href="#" onclick="deleteWrap('{{ wrap.wrap_id }}')">Delete</a>
                        | <a href="{% url 'analyze_wrap' wrap.wrap_id %}">Analyze</a>
                    </li>
                {% endfor %}
            </ul>
        {% endif %}
        <a href="{% url 'create_wrap' %}">
            <button class="createBTN"> Create </button>
        </a>
    </div>
    <script>
        function deleteWrap(wrapId) {
            if (confirm("Are you sure you want to delete this wrap?")) {
                fetch(`/wrap/delete/${wrapId}/`, {
                    method: 'POST',
                    headers: {
                        'X-CSRFToken': '{{ csrf_token }}',
                    },
                })
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'success') {
                        alert(data.message);
                        location.reload(); // Refresh the page to reflect changes
                    } else {
                        alert(data.message);
                    }
                })
                .catch(error => console.error('Error:', error));
            }
        }
    </script>
</body>

</html>
